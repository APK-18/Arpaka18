<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARPAKA18 | Run</title>
    <link rel="icon" href="img/CABEZA BLANCO ICO.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sky-blue: #a3e4f7;
            --andes-gold: #ffc107;
            --grass-dark: #2e7d32;
            --primary-orange: #ff8a65;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #4fc3f7;
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #4fc3f7 0%, #a3e4f7 100%);
            overflow: hidden;
        }

        /* Overlay de OrientaciÃ³n */
        #orientation-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #2196f3;
            z-index: 10000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .phone-icon {
            width: 50px;
            height: 90px;
            border: 3px solid white;
            border-radius: 6px;
            margin-bottom: 20px;
            position: relative;
            animation: rotateDevice 2s infinite ease-in-out;
        }

        .phone-icon::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            border: 1px solid white;
            border-radius: 50%;
        }

        @keyframes rotateDevice {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-90deg); }
            100% { transform: rotate(-90deg); }
        }

        /* Mostrar solo en mÃ³viles en vertical */
        @media (max-width: 900px) and (orientation: portrait) {
            #orientation-overlay {
                display: flex;
            }
        }

        /* --- Estilos Originales --- */
        .mountain {
            position: absolute;
            bottom: 80px;
            background: #78909c;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        .snow-cap {
            position: absolute;
            top: 0;
            left: 30%;
            width: 40%;
            height: 20%;
            background: white;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        .floor {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80px;
            background: #5c493b;
            border-top: 8px solid #6b905c;
            z-index: 10;
        }

        #alpaca-wrapper {
            position: absolute;
            bottom: 80px;
            left: 60px;
            width: 70px;
            height: 85px;
            z-index: 50;
            transition: transform 0.1s;
        }

        #alpaca-sprite {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .game-font { font-family: 'Fredoka One', cursive; }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border: 2px solid #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 12px;
        }

        .item { position: absolute; z-index: 20; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        
        #shield-aura {
            position: absolute;
            inset: -10px;
            border: 3px solid #00e5ff;
            border-radius: 50%;
            animation: pulse 1s infinite;
            display: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0; }
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.8;
            pointer-events: none;
        }

        .turbo-effect {
            animation: shake 0.1s infinite;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -1px); }
            100% { transform: translate(1px, -1px); }
        }
    </style>
</head>
<body>

<!-- Aviso de RotaciÃ³n -->
<div id="orientation-overlay">
    <div class="phone-icon"></div>
    <h1 class="game-font text-2xl mb-2">Â¡GIRA TU DISPOSITIVO!</h1>
    <p class="text-sm px-10">Para una mejor jugabilidad, utiliza el modo horizontal.</p>
</div>

<div id="game-container">
    <!-- UI Layer -->
    <div class="absolute top-4 left-4 right-4 flex justify-between items-start z-[100]">
        <div class="flex flex-col gap-2">
            <div class="stat-card px-3 py-1 flex items-center gap-2">
                <span class="text-lg">ðŸŒµ</span>
                <div id="score" class="text-md game-font text-green-700">0</div>
            </div>
            <div class="stat-card px-3 py-1 flex items-center gap-2">
                <span class="text-lg">ðŸª™</span>
                <div id="coins" class="text-md game-font text-yellow-600">0</div>
            </div>
        </div>
        
        <div class="stat-card px-3 py-1 text-center">
            <div class="text-[8px] uppercase font-bold text-gray-400">RÃ©cord Mundial</div>
            <div id="highscore" class="text-sm game-font text-orange-600">0</div>
        </div>
    </div>

    <!-- Background Layers -->
    <div id="clouds-layer"></div>
    <div id="mountains-layer"></div>

    <!-- Alpaca -->
    <div id="alpaca-wrapper">
        <div id="shield-aura"></div>
        <img id="alpaca-sprite" src="img/ArpakaVolteada.png" alt="Alpaca">
    </div>

    <!-- Floor -->
    <div class="floor"></div>

    <!-- Game Over Screen -->
    <div id="game-over" class="hidden absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[2000]">
        <div class="bg-white p-8 rounded-3xl text-center max-w-[300px] w-[90%] shadow-2xl">
            <h2 class="game-font text-3xl text-red-500 mb-2">Â¡FIN DEL VIAJE!</h2>
            <div id="record-banner" class="hidden bg-yellow-100 text-yellow-700 text-[10px] font-bold py-1 px-3 rounded-full mb-4 inline-block">NUEVO RÃ‰CORD</div>
            
            <div class="flex justify-around mb-6">
                <div>
                    <p class="text-[10px] uppercase font-bold text-gray-400">Puntaje</p>
                    <p id="final-score" class="text-2xl game-font text-slate-700">0</p>
                </div>
                <div>
                    <p class="text-[10px] uppercase font-bold text-gray-400">Monedas</p>
                    <p id="final-coins" class="text-2xl game-font text-slate-700">0</p>
                </div>
            </div>
            
            <button id="retry-btn" class="w-full py-4 rounded-2xl bg-orange-500 hover:bg-orange-600 text-white game-font text-xl transition-all active:scale-95 shadow-lg border-b-4 border-orange-700">
                REINTENTAR
            </button>
        </div>
    </div>
</div>

<script>
    const config = {
        gravity: 0.8,
        jumpPower: -15,
        baseSpeed: 8,
        maxSpeed: 18,
        spawnInterval: 1800
    };

    let state = {
        active: false,
        score: 0,
        coins: 0,
        highscore: parseInt(localStorage.getItem('alpaca_extreme_high')) || 0,
        speed: config.baseSpeed,
        y: 0,
        velY: 0,
        jumps: 0,
        entities: [],
        lastSpawn: 0,
        hasShield: false,
        isTurbo: false
    };

    const container = document.getElementById('game-container');
    const alpaca = document.getElementById('alpaca-wrapper');
    const scoreUI = document.getElementById('score');
    const coinsUI = document.getElementById('coins');
    const highscoreUI = document.getElementById('highscore');
    const gameOverScreen = document.getElementById('game-over');
    const shieldAura = document.getElementById('shield-aura');

    function spawn() {
        if(!state.active) return;
        
        const r = Math.random();
        let entity = null;

        if(r < 0.15) {
            entity = { type: 'coin', label: 'ðŸª™', w: 35, h: 35, y: 80 + 50 + Math.random()*100, collect: true };
        } else if(r < 0.20) {
            entity = { type: 'shield', label: 'ðŸ›¡ï¸', w: 35, h: 35, y: 80 + 80, collect: true };
        } else if(r < 0.25) {
            entity = { type: 'turbo', label: 'âš¡', w: 35, h: 35, y: 80 + 30, collect: true };
        } else {
            const size = 50 + Math.random() * 30;
            entity = { type: 'obs', label: 'ðŸŒµ', w: size, h: size, y: 80, collect: false, scored: false };
        }

        const el = document.createElement('div');
        el.className = 'item';
        el.style.fontSize = entity.w + 'px';
        el.innerHTML = entity.label;
        el.style.left = window.innerWidth + 'px';
        el.style.bottom = entity.y + 'px';
        container.appendChild(el);
        
        state.entities.push({ ...entity, el, x: window.innerWidth });
    }

    function gameLoop(time) {
        if(!state.active) return;

        // FÃ­sica Salto
        state.velY += config.gravity;
        state.y -= state.velY;
        
        if(state.y < 0) {
            state.y = 0;
            state.velY = 0;
            state.jumps = 0;
        }
        
        alpaca.style.bottom = (80 + state.y) + 'px';

        // Spawn LÃ³gica
        if(time - state.lastSpawn > config.spawnInterval / (state.speed/8)) {
            spawn();
            state.lastSpawn = time;
        }

        // Entidades
        const aRect = alpaca.getBoundingClientRect();

        for(let i = state.entities.length - 1; i >= 0; i--) {
            const ent = state.entities[i];
            ent.x -= state.speed;
            ent.el.style.left = ent.x + 'px';

            const eRect = ent.el.getBoundingClientRect();

            // ColisiÃ³n Circular aproximada
            const dist = Math.hypot(
                (aRect.left + aRect.width/2) - (eRect.left + eRect.width/2),
                (aRect.top + aRect.height/2) - (eRect.top + eRect.height/2)
            );

            if(dist < (aRect.width/2 + eRect.width/3)) {
                if(ent.collect) {
                    handlePowerup(ent.type);
                    ent.el.remove();
                    state.entities.splice(i, 1);
                } else if(!state.isTurbo) {
                    if(state.hasShield) {
                        state.hasShield = false;
                        shieldAura.style.display = 'none';
                        ent.el.remove();
                        state.entities.splice(i, 1);
                    } else {
                        gameOver();
                        return;
                    }
                }
            }

            if(!ent.collect && !ent.scored && ent.x < aRect.left) {
                ent.scored = true;
                state.score++;
                scoreUI.innerText = state.score;
                if(state.score % 10 === 0) state.speed = Math.min(config.maxSpeed, state.speed + 0.5);
            }

            if(ent.x < -100) {
                ent.el.remove();
                state.entities.splice(i, 1);
            }
        }

        requestAnimationFrame(gameLoop);
    }

    function handlePowerup(type) {
        if(type === 'coin') {
            state.coins++;
            coinsUI.innerText = state.coins;
        } else if(type === 'shield') {
            state.hasShield = true;
            shieldAura.style.display = 'block';
        } else if(type === 'turbo') {
            activateTurbo();
        }
    }

    function activateTurbo() {
        state.isTurbo = true;
        const oldSpeed = state.speed;
        state.speed *= 2;
        alpaca.classList.add('turbo-effect');
        setTimeout(() => {
            state.isTurbo = false;
            state.speed = oldSpeed;
            alpaca.classList.remove('turbo-effect');
        }, 3000);
    }

    function gameOver() {
        state.active = false;
        document.getElementById('final-score').innerText = state.score;
        document.getElementById('final-coins').innerText = state.coins;
        
        const recordBanner = document.getElementById('record-banner');
        if(state.score > state.highscore) {
            state.highscore = state.score;
            localStorage.setItem('alpaca_extreme_high', state.highscore);
            recordBanner.classList.remove('hidden');
        } else {
            recordBanner.classList.add('hidden');
        }
        highscoreUI.innerText = state.highscore;
        gameOverScreen.classList.remove('hidden');
    }

    function start() {
        state.entities.forEach(e => e.el.remove());
        state.entities = [];
        state.score = 0; state.coins = 0;
        state.speed = config.baseSpeed;
        state.y = 0; state.velY = 0;
        state.active = true;
        state.hasShield = false; state.isTurbo = false;
        scoreUI.innerText = "0";
        coinsUI.innerText = "0";
        shieldAura.style.display = 'none';
        gameOverScreen.classList.add('hidden');
        setupClouds();
        requestAnimationFrame(gameLoop);
    }

    function setupClouds() {
        const layer = document.getElementById('clouds-layer');
        layer.innerHTML = '';
        for(let i=0; i<6; i++) {
            const c = document.createElement('div');
            c.className = 'cloud';
            c.style.width = (100 + Math.random() * 100) + 'px';
            c.style.height = '40px';
            c.style.top = (Math.random() * 40) + '%';
            c.style.left = (Math.random() * 100) + '%';
            layer.appendChild(c);
        }
    }

    // Controles
    const triggerJump = () => {
        if(state.active) {
            if(state.jumps < 2) { 
                state.velY = config.jumpPower; 
                state.jumps++; 
            }
        } else if(!gameOverScreen.classList.contains('hidden')) {
            start();
        }
    };

    window.addEventListener('keydown', (e) => {
        if(e.code === 'Space' || e.code === 'ArrowUp') triggerJump();
    });

    container.addEventListener('touchstart', (e) => {
        // Evitar saltar si se estÃ¡ tocando el botÃ³n de reintentar
        if(e.target.id !== 'retry-btn') {
            e.preventDefault();
            triggerJump();
        }
    }, { passive: false });

    document.getElementById('retry-btn').addEventListener('click', (e) => {
        e.stopPropagation();
        start();
    });

    // Init
    highscoreUI.innerText = state.highscore;
    start();
</script>

</body>
</html>